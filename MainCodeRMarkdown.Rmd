---
title: "MainCodeRMarkdown"
author: ""
date: "Change to due date"
output: html_document
---

```{r install}
if(!require(knitr)){
    install.packages("knitr", repos = "https://cran.r-project.org")
    library(knitr)
}

if(!require(tidyverse)){
  install.packages("tidyverse")
  library(tidyverse)
  library(dplyr)
}

if(!require(ggbeeswarm)){
 install.packages("ggbeeswarm")
  library(ggbeeswarm)
}

if(!require(ggforce)){
 install.packages("ggforce")
  library(ggforce)
}  

if(!require(ggplot2)){
 install.packages("ggplot2")
  library(ggplot2)
}  
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Question: Does family income affect the average educational progress? 

#Karin: ANOVA 
#Chenzi: Post-hoc ANOVA 
#Eric: Interpretation of Visualizations / For loops for Anova Testing and visualization / Backward function for linear regression / All work is on Eric.rmd file 
#Kashish: Visualization 

#Family Income as correlated to other variables: 
#Variable: Extracurrciular_Activities, Access_to_Resources, Hours Studied, Parental_Involvement, Tutoring_Sessions, School_Type, Parental_Educational_Level 

**INITIAL DATA CLEAN + SET UP**
```{r}
# read initial data
studentperformance.initial <- read.csv("StudentPerformanceFactors.csv")
head(studentperformance.initial)
```

```{r}
# clean data
cleaned_data <- na.omit(studentperformance.initial)
if (nrow(cleaned_data) == 0) {
  stop("All rows contain missing values. Cannot proceed with model.")
}
str(cleaned_data)
head(cleaned_data)
```

```{r}
# change the class type of all categorical variables to factor levels so they could be seen as categories when analyzing using r. continuous variables being the integer type is good
cleaned_data[] <- lapply(cleaned_data, function(x) {
  if (is.character(x)) 
    as.factor(x) 
  else 
    x
})

sapply(cleaned_data, class)
cleaned_data

studentperformance <- cleaned_data
```

```{r}
# create new column for student progress
studentperformance$Progress <- studentperformance$Exam_Score - studentperformance$Previous_Scores
head(studentperformance, 5)
```

**AVERAGES OF OUR NUMERICAL VARIABLES**
```{r}
#see what kind of variables Hours_Studied and Tutoring Sessions Are 
class(studentperformance$Hours_Studied)

class(studentperformance$Tutoring_Sessions)

#since these are factor variables: calculate the mode and frequency distribution

# list of factor variables to calculate statistics for
factor.interest.variables <- c("Hours_Studied", "Tutoring_Sessions")

# calculate mode
# define a function for mode calculation
mode <- function(x) {
  uniq_x <- unique(x)
  uniq_x[which.max(tabulate(match(x, uniq_x)))]  # Return the most frequent value
}

#loop through each factor variable and calculate the mode
for (var in factor.interest.variables) {
  mode_value <- mode(studentperformance[[var]])
  
# print the results
  cat("Mode for", var, ":", mode_value, "\n")
}

#calculate frequency distribution
#loop through each factor variable and calculate the frequency distribution
for (var in factor.interest.variables) {
  freq_table <- table(studentperformance[[var]])

# print the frequency table
  cat("Frequency distribution for", var, ":\n")
  print(freq_table)
  cat("---------------------------------\n")
}

```

ATTACH ANALYSIS HERE 

**VISUALIZATION OF OUR CHOSEN VARIABLES**
```{r}
# barplot visualization of variables of interest: Extracurrciular_Activities, Access_to_Resources, Hours Studied, Parental_Involvement, Tutoring_Sessions, School_Type, Parental_Educational_Level 

#create the interest variables that we need to graph
interest.variables <- c("Extracurricular_Activities", "Access_to_Resources", "Hours_Studied", 
               "Parental_Involvement", "Tutoring_Sessions", "School_Type", 
               "Parental_Education_Level")

# loop through each variable and create a bar chart
for (var in interest.variables) {
  barplot <- ggplot(studentperformance, aes(x = !!sym(var), fill = Family_Income)) +
    geom_bar(position = "dodge") +
    labs(title = paste("Distribution of", var, "by Family Income"),
         x = var, 
         y = "Count") +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
  
# print the plot
  print(barplot)
}
```

ATTACH ANALYSIS HERE 

```{r}
#mosaic chart visualization of our (5) categorical variables of interest: Extracurrciular_Activities, Access_to_Resources, Parental_Involvement, School_Type, Parental_Educational_Level 

# create a new set of variables for just categorical ones we are testing 
cat.interest.variables <-  c("Extracurricular_Activities", "Access_to_Resources",
               "Parental_Involvement", "School_Type", "Parental_Education_Level")

#install package to be able to plot a mosaic plot 
if(!require(ggmosaic)){
    install.packages("ggmosaic", repos = "https://cran.r-project.org")
    library(ggmosaic)
}

#change to as factor 
studentperformance$Family_Income <- as.factor(studentperformance$Family_Income)
studentperformance[[var]] <- as.factor(studentperformance[[var]])

# loop through each variable and create a mosaic plot
for (var in cat.interest.variables) {
  mosaic.plot <- ggplot(studentperformance) +
    geom_mosaic(aes(weight = 1, x = product(Family_Income), fill = !!sym(var)), na.rm = TRUE) +
    labs(title = paste("Mosaic Plot of", var, "by Family Income"),
         x = "Family Income",
         y = "Proportion",
         fill = var) +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
  
  # Print the plot
  print(mosaic.plot)
}
```

ATTACH ANALYSIS HERE 

```{r}
#spineplot chart visualization of our (2) factor variables of interest: Hours_Studied and Tutoring Sessions

# loop through each variable and create a spineplot
for (var in factor.interest.variables) {
  spineplot <- ggplot(studentperformance, aes(x = !!sym(var), fill = Family_Income)) +
    geom_bar(position = "fill", width = 0.7) +
    labs(title = paste("Spineplot of", var, "by Family Income"),
         x = var,
         y = "Proportion",
         fill = "Family Income") +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
  
  # Print the plot
  print(spineplot)
}
```

ATTACH ANALYSIS HERE 

**CORRELATION TEST OF CHISQUARE -- WE MIGHT NEED TO CHANGE ALPHA VALUE TO SOMETING DIFF IN ORDER TO MAKE SOME VARIABLES STATISTICALLY SIGNIFICANT; RN, NONE ARE HIGHLY CORRELATED** 
```{r}
#check for assumptions for chi-square

# loop through each variable to check assumptions
for (var in cat.interest.variables) {
  # Create a contingency table
  contingency_table <- table(studentperformance[[var]], studentperformance$Family_Income)
  
  # Check independence assumption (cannot directly test but mention it's assumed)
  cat("Checking assumptions for", var, "vs Family_Income:\n")
  cat("Independence of observations: Assumed based on data collection.\n")
  
  # Calculate expected frequencies
  expected_freq <- chisq.test(contingency_table)$expected
  
  # Check if all expected frequencies are >= 5
  if (all(expected_freq >= 5)) {
    cat("All expected frequencies are >= 5. The Chi-Square test assumption is met.\n")
  } else {
    cat("Warning: Some expected frequencies are < 5. The Chi-Square test assumption is violated.\n")
    cat("Expected frequencies:\n")
    print(expected_freq)
  }
  
  cat("\n-------------------------------------------\n")
}
```

All assumptions for the Chi-Square Test have been met to run for categorical interest variables. 

```{r}
#chi-square analysis of our categorical variables of interest: Extracurricular_Activities, Access_to_Resources, Parental_Involvement, School_Type, Parental_Educational_Level 
  
# loop through each variable and run the Chi-Square test
for (var in cat.interest.variables) {
  contingency_table <- table(studentperformance[[var]], studentperformance$Family_Income)
  chi_test <- chisq.test(contingency_table)
  
# display the results
  cat("Chi-Square Test for", var, "vs Family_Income:\n")
  print(chi_test)
  cat("\n-------------------------------------------\n")
}

```

For all variables: P-value of this chi-square test looks to be larger than 0.05 -- this means that there is weak correlation between the two variables.  
